// 1. Open your Google Sheet.
// 2. Go to Extensions > Apps Script.
// 3. Paste this entire code into the editor, replacing any existing code.
// 4. Click the "Deploy" button -> "New deployment".
// 5. For "Select type", choose "Web app".
// 6. In the "New deployment" dialog:
//    - For "Description", you can write "Portfolio Contact Form".
//    - For "Execute as", select "Me".
//    - For "Who has access", select "Anyone". This is very important.
// 7. Click "Deploy".
// 8. Authorize the script when prompted.
// 9. A "Deployment successful" dialog will appear with a "Web app URL". Copy this URL.
// 10. You will need this URL to update the contact form component in your Next.js app.

const SHEET_NAME = 'ContactFormSubmissions';

function doPost(e) {
  try {
    const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(SHEET_NAME);
    if (!sheet) {
      throw new Error(`Sheet "${SHEET_NAME}" not found.`);
    }

    // Parse the incoming data from the form
    const data = JSON.parse(e.postData.contents);

    // Get the current date and time
    const timestamp = new Date();

    // Append a new row to the sheet
    sheet.appendRow([
      timestamp,
      data.name,
      data.email,
      data.message
    ]);

    // Return a success response
    return ContentService
      .createTextOutput(JSON.stringify({ 'result': 'success' }))
      .setMimeType(ContentService.MimeType.JSON);

  } catch (error) {
    // Return an error response
    return ContentService
      .createTextOutput(JSON.stringify({ 'result': 'error', 'message': error.message }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}
